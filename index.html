<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package-Specific Email Customization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .tab-active {
            border-bottom: 3px solid #005A9C;
            font-weight: 600;
            color: #005A9C;
            padding-bottom: 8px;
        }
        /* Ensures line breaks in the template strings are displayed in the textarea */
        .email-body-content {
            resize: none;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Main Container -->
    <div class="p-4 sm:p-8">

        <!-- Header Tabs -->
        <div class="max-w-xl mx-auto flex justify-center space-x-8 mb-10 border-b border-gray-200">
            <div class="text-gray-500 cursor-pointer p-2 rounded-t-lg transition duration-150">Logo</div>
            <div class="tab-active cursor-pointer p-2 rounded-t-lg transition duration-150">Welcome Email</div>
            <div class="text-gray-500 cursor-pointer p-2 rounded-t-lg transition duration-150">Verifications</div>
        </div>

        <!-- Email Customization Card (Single Pane) -->
        <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-lg h-fit">
            
            <!-- Header and Save Button -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">Customize Welcome Email by Package</h1>
                    <p class="text-gray-500 mt-1">Select a package to view and edit its unique welcome message.</p>
                </div>
                <button onclick="saveChanges(true)" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150">
                    Save Changes
                </button>
            </div>

            <!-- Package Selector -->
            <div class="mb-8 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <label for="package-selector" class="text-sm font-semibold text-gray-700 block mb-2">Select Package Name to Edit:</label>
                <select id="package-selector" onchange="handlePackageSwitch(this.value)"
                    class="block w-full px-4 py-3 text-base text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 cursor-pointer">
                </select>
                <div class="mt-3 text-sm text-gray-600">Active Package ID: <span id="active-package-id" class="font-mono text-xs break-all text-gray-800">...</span></div>
            </div>
            
            <!-- Editable Fields -->
            <div class="space-y-6">
                
                <!-- Title Field (Editable input) -->
                <div>
                    <label class="text-sm font-semibold text-gray-700 block mb-1">Title:</label>
                    <input type="text" id="email-title" class="p-3 w-full bg-white border border-gray-300 rounded-lg text-gray-800 font-medium shadow-inner focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <!-- Body Field (Editable textarea) -->
                <div>
                    <label class="text-sm font-semibold text-gray-700 block mb-1">Body (Customized Template Content):</label>
                    <textarea id="email-body" class="email-body-content p-4 w-full h-64 bg-white border border-gray-300 rounded-lg text-gray-800 shadow-inner overflow-y-auto focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                </div>
            </div>
        </div>

        <!-- Toast Notification for saving -->
        <div id="save-toast" class="fixed bottom-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-xl transition-opacity duration-300 opacity-0 z-50">
            Changes saved successfully!
        </div>

    </div>

    <script>
        // --- Global Data Stores and Constants ---
        let currentPackageId = '';

        // Initial default structure for all packages
        const initialPackageData = {
            '6862631bb1f61ea810e0fb524': { 
                name: 'ADP Fingerprint', 
                title: 'Bluetest screening invitation - (Fingerprint Required)', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: ADP FINGERPRINT**
This package requires a physical fingerprinting appointment. A link to schedule your appointment will be available after you accept this invitation. Please bring a valid photo ID.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '66cdc1f849d72b50a3f7be33': { 
                name: 'Add And Edit', 
                title: 'Bluetest screening invitation - (Review & Edit)', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: ADD AND EDIT**
This package allows a **48-hour window** to review and edit your submission details after initial entry. Please ensure all information is accurate before the deadline.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '650851b0fbd3d487d4e67aa50': { 
                name: 'All OHS Checks', 
                title: 'Bluetest screening invitation - (OHS Compliance)', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: OHS CHECKS**
Your screening includes compliance checks for Occupational Health and Safety (OHS). Please pay close attention to the required OHS forms in the next step.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '64a86ce44121b4497fd4286f5': { 
                name: 'All Checks', 
                title: 'Bluetest screening invitation - (Standard Check)', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: STANDARD**
You are registered for a standard, comprehensive background check package.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '64a7a1b1fafb428e4e72a31': { 
                name: 'All Verification Checks', 
                title: 'Bluetest screening invitation - (Verification Required)', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: VERIFICATION**
This package requires identity verification via document upload. Please have your official documents ready before starting the process.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '66c0eed3bbfb8fbb1c08158': { 
                name: 'Aug28 Cc', 
                title: 'Bluetest screening invitation', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: AUG28 CC**
This is the Aug28 Cc package. Customize this section with specific requirements for this package.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '6666c0fdf3ac7e1b8e393b3': { 
                name: 'Auto PAA with Colorado Caps', 
                title: 'Bluetest screening invitation', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: COLORADO CAPS**
This package includes specific regulatory checks for Colorado candidates. Please read the consent forms carefully.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
            '65d72cb8c25491f3c25e871': { 
                name: 'AutoPAA Dynamic Package', 
                title: 'Bluetest screening invitation', 
                body: `Hi {{applicant_name}},

**YOUR SCREENING INVITATION**
You have been invited by Bluetest Client to initiate your background screening process.
You will be asked to provide Vetty with the necessary information to conduct a background screening on behalf of Bluetest client.

**PACKAGE DETAILS: DYNAMIC**
This package dynamically adapts based on your location and role. Ensure your personal details are up-to-date.

**NEXT STEPS**
Please click the link below to accept the invitation and begin your screening process.

**SUPPORT & QUESTIONS**
If you have any questions about the screening process, please contact Bluetest client for further details.` 
            },
        };

        // --- 2. Persistence and Initialization ---
        function loadData() {
            const storedData = localStorage.getItem('packageCustomizations');
            // Merge stored data with initial data to ensure all packages are present
            const loadedData = storedData ? JSON.parse(storedData) : {};
            return { ...initialPackageData, ...loadedData };
        }

        function saveData(data) {
            // Only store the data that has been customized (to keep storage clean, although not strictly necessary here)
            // For simplicity in this demo, we'll store everything currently loaded.
            localStorage.setItem('packageCustomizations', JSON.stringify(data));
        }

        let packageCustomizations = loadData();

        // --- 3. UI Helper Functions ---

        function showToast(message) {
            const toast = document.getElementById('save-toast');
            toast.textContent = message;
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 3000);
        }

        function populatePackageSelector() {
            const selector = document.getElementById('package-selector');
            selector.innerHTML = '';
            
            const packageIds = Object.keys(packageCustomizations).sort();

            packageIds.forEach(id => {
                const option = document.createElement('option');
                option.value = id;
                // Display only the package name in the dropdown
                option.textContent = packageCustomizations[id].name;
                selector.appendChild(option);
            });
            // Set initial selection
            currentPackageId = packageIds[0];
            selector.value = currentPackageId;
        }

        // --- 4. Package Editing Functions ---

        function loadPackage(packageId) {
            const pkg = packageCustomizations[packageId];
            
            document.getElementById('email-title').value = pkg.title;
            document.getElementById('email-body').value = pkg.body;
            // Display the full Package ID below the selector
            document.getElementById('active-package-id').textContent = packageId;
        }

        function saveChanges(showToast = false) {
            if (!currentPackageId) return;

            const newTitle = document.getElementById('email-title').value;
            const newBody = document.getElementById('email-body').value;

            // Update the in-memory data
            if (packageCustomizations[currentPackageId]) {
                packageCustomizations[currentPackageId].title = newTitle;
                packageCustomizations[currentPackageId].body = newBody;
                saveData(packageCustomizations);
                if (showToast) showToast('Changes saved successfully!');
            }
        }

        function handlePackageSwitch(newPackageId) {
            // 1. Auto-Save changes for the previously active package
            saveChanges(false); 

            // 2. Update current ID and load the new package
            currentPackageId = newPackageId;
            loadPackage(newPackageId);
        }

        // --- 5. Initialization ---
        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            populatePackageSelector();
            // Load the first package in the list
            if (currentPackageId) {
                loadPackage(currentPackageId);
            }
        }
    </script>

</body>
</html>
